<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Veiculo</title>

    <link rel="stylesheet" href="css/body.css">
    <link rel="stylesheet" href="css/estruturaLogado.css">
    <link rel="stylesheet" href="css/buscarVeiculo.css">
</head>

<body>
    <div class="principal">
        <div class="navBarLateral">
            <div>
                <img id="logo" src="./imagens/veezyBranco.png" alt="">
                <p>Seja bem vindo,</p>
                <p><span id="b_usuario"> </span>!</p>

            </div>
            <div>
                <div id="botaoDashboard">
                    <a href="dashboard.html">
                        <div class="botao">
                            <img src="./imagens/dashboardIcone.png" alt="dashboardIcone">
                            <p>Dashboard</p>
                        </div>
                    </a>
                </div>
                <a href="buscarVeiculo.html">
                    <div class="botao selecionado">
                        <img src="./imagens/searchIcon.png" alt="icone">
                        <p>Buscar</p>
                    </div>
                </a>
                <a href="veiculosRecomendados.html">
                    <div class="botao">
                        <img src="./imagens/carIcon.png" alt="icone">
                        <p>Veiculos</p>
                    </div>
                </a>
            </div>
            <div>
                <a href="index.html">
                    <div class="botao">
                        <img src="./imagens/logoutIcone.svg" alt="icone">
                        <p>Sair</p>
                    </div>
                </a>
            </div>
        </div>
        <div class="conteudo">
            <div class="titulo-conteudo">
                <h2>Busque o seu veiculo!</h2>
            </div>
            <div class="propagandaVeezy">
                <div class="informacoesEImagem">
                    <div class="informacoes">
                        <h2>Está na hora de dirigir a sua escolha!</h2>

                        <div class="caracteristica">
                            <h3>Em menos de 2 minutos!</h3>
                            <p>Responda apenas 8 perguntas rápidas e receba uma recomendação personalizada com a ajuda da inteligência artificial da Veezy.</p>
                        </div>
                        
                        <div class="caracteristica">
                            <h3>Gerado por Gemini</h3>
                            <p>Com base no seu perfil, analisamos consumo, conforto, manutenção e custo-benefício para indicar o veículo ideal para sua realidade.</p>
                        </div>
                        <div onclick="acao()" class="btn">Responder formulário</div>
                    </div>
                    <div class="wallpaper"><img src="imagens/wallpaperBmwM4cs.jpg" alt=""></div>
                </div>
                <div class="modal">
                    <div class="navbarModal">
                        <div class="sair">
                            <div onclick="fechar()" class="fechar">X</div>
                        </div>
                        <div class="titulo">
                            <h3>Preencha as informações a seguir</h1>
                        </div>
                    </div>
                    <div class="perguntas">
                        <p>Qual será o principal uso do veículo?</p>
                        <select id="select_uso" name="select_uso">
                            <option value="">Selecione</option>
                            <option value="urbano">Uso urbano (cidade)</option>
                            <option value="rodovia">Viagens / rodovias</option>
                            <option value="misto">Uso misto (cidade e estrada)</option>
                            <option value="trabalho">Trabalho / transporte de carga</option>
                            <option value="lazer">Lazer / finais de semana</option>
                        </select>

                        <p>Qual a distância média do trajeto diário?</p>
                        <select id="select_trajeto" name="select_trajeto">
                            <option value="">Selecione</option>
                            <option value="curto">Até 10 km</option>
                            <option value="medio">Entre 10 e 30 km</option>
                            <option value="longo">Mais de 30 km</option>
                        </select>

                        <p>Qual tipo de combustível você prefere?</p>
                        <select id="select_combustivel" name="select_combustivel">
                            <option value="">Selecione</option>
                            <option value="flex">Flex (etanol/gasolina)</option>
                            <option value="gasolina">Gasolina</option>
                            <option value="etanol">Etanol</option>
                            <option value="diesel">Diesel</option>
                            <option value="eletrico">Elétrico</option>
                            <option value="hibrido">Híbrido</option>
                        </select>

                        <p>Você tem preferência por câmbio manual ou automático?</p>
                        <select id="select_cambio" name="select_cambio">
                            <option value="">Selecione</option>
                            <option value="manual">Manual</option>
                            <option value="automatico">Automático</option>
                            <option value="indiferente">Indiferente</option>
                        </select>

                        <p>Quantas pessoas costumam andar no carro com frequência?</p>
                        <select id="select_passageiros" name="select_passageiros">
                            <option value="">Selecione</option>
                            <option value="1">Apenas o motorista</option>
                            <option value="2">Duas pessoas</option>
                            <option value="3-4">Três a quatro pessoas</option>
                            <option value="5+">Cinco ou mais</option>
                        </select>

                        <p>Qual o seu orçamento aproximado para compra?</p>
                        <select id="select_orcamento" name="select_orcamento">
                            <option value="">Selecione</option>
                            <option value="30000">Até R$30.000</option>
                            <option value="50000">R$30.001 a R$50.000</option>
                            <option value="80000">R$50.001 a R$80.000</option>
                            <option value="120000">R$80.001 a R$120.000</option>
                            <option value="300000">R$120.001 a R$300.000</option>
                            <option value="600000">R$300.001 a R$600.000</option>
                            <option value="800000">R$600.001 a R$800.000</option>
                            <option value="999999">R$800.001 a R$1.000.000</option>
                        </select>

                        <p>Economia ou desempenho?</p>
                        <select id="select_prioridade" name="select_prioridade">
                            <option value="">Selecione</option>
                            <option value="economia">Economia</option>
                            <option value="desempenho">Desempenho</option>
                            <option value="equilibrado">Equilíbrio entre os dois</option>
                        </select>
                        <br>
                        <button onclick="pesquisarCarro()" class="buscarVeiculo">Solicitar busca de veículo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    const idUsuario = sessionStorage.ID_USUARIO;

    const botaoDashboard = document.getElementById('botaoDashboard')

    if(idUsuario == 22){
        botaoDashboard.style.display = 'block'
    }

    function acao() {
        let modal = document.querySelector('.modal')
        modal.style.display = 'block';
    }
    function fechar() {
        let modal = document.querySelector('.modal')
        modal.style.display = 'none';
    }

    async function pesquisarCarro() {
        var uso = select_uso.value
        var trajeto = select_trajeto.value
        var combustivel = select_combustivel.value
        var cambio = select_cambio.value
        var passageiros = select_passageiros.value
        var orcamento = select_orcamento.value
        var prioridade = select_prioridade.value

        if (uso == '' || trajeto == '' || combustivel == '' || cambio == '' || passageiros == '' || orcamento == '' || prioridade == '') {
            alert('Todos os campos devem ser preenchidos')
        } else {
            const response = await fetch('/iaGemini/pergunta', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    uso: select_uso.value, trajeto: select_trajeto.value, combustivel: select_combustivel.value,
                    cambio: select_cambio.value, passageiros: select_passageiros.value, orcamento: select_orcamento.value, prioridade: select_prioridade.value
                })
            });
            const data = await response.json();
            console.log(data)
            fetch("/iaGemini/cadastrarVeiculo", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    marcaServer: data.marca,
                    modeloServer: data.modelo,
                    anoServer: data.ano,
                    categoriaServer: data.categoria,
                    motorServer: data.motor,
                    potenciaServer: data.potencia,
                    cambioServer: data.cambio,
                    consumo_medioServer: data.consumo_medio,
                    capacidade_porta_malasServer: data.capacidade_porta_malas,
                    numero_ocupantesServer: data.numero_ocupantes,
                    preco_medio_mercadoServer: data.preco_medio_mercado,
                    tipo_combustivelServer: data.tipo_combustivel,
                    justificativaServer: data.justificativa,
                    fkVisitanteServer: sessionStorage.ID_USUARIO
                }),

            })
                .then(function (resposta) {

                    if (resposta.ok) {
                        setTimeout(() => {
                            window.location = "veiculosRecomendados.html";
                        }, "800");

                    } else {
                        throw `Houve um erro ao tentar realizar o cadastro!`;
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
        }
    }
</script>

</html>